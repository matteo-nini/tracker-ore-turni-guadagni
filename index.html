<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker Ore Lavoro</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body onload="initializeApp()">
    <div class="container">
        <div class="header-container">
            <h1><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-chart-no-axes-column-icon lucide-chart-no-axes-column">
                    <path d="M5 21v-6" />
                    <path d="M12 21V3" />
                    <path d="M19 21V9" />
                </svg> Tracker Ore Lavoro e Guadagni</h1>
            <div id="profile-controls">
                <div id="profile-selector-group">
                    <label for="profileSelector"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-icon lucide-user">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg> Profilo:</label>
                    <select id="profileSelector" onchange="openLoginModal()"></select>
                </div>
                <button id="create-profile-btn" onclick="openCreateProfileModal()" title="Crea Nuovo Profilo"><svg
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-user-round-plus-icon lucide-user-round-plus">
                        <path d="M2 21a8 8 0 0 1 13.292-6" />
                        <circle cx="10" cy="8" r="5" />
                        <path d="M19 16v6" />
                        <path d="M22 19h-6" />
                    </svg></button>
                <button id="settings-btn" onclick="openSettingsModal()" title="Impostazioni Calcoli"><svg
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-user-round-cog-icon lucide-user-round-cog">
                        <path d="m14.305 19.53.923-.382" />
                        <path d="m15.228 16.852-.923-.383" />
                        <path d="m16.852 15.228-.383-.923" />
                        <path d="m16.852 20.772-.383.924" />
                        <path d="m19.148 15.228.383-.923" />
                        <path d="m19.53 21.696-.382-.924" />
                        <path d="M2 21a8 8 0 0 1 10.434-7.62" />
                        <path d="m20.772 16.852.924-.383" />
                        <path d="m20.772 19.148.924.383" />
                        <circle cx="10" cy="8" r="5" />
                        <circle cx="18" cy="18" r="3" />
                    </svg></button>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>Ore Settimana Corrente</h3>
                <div class="value" id="weekHours">0</div>
                <div class="subtitle" id="contractualHoursSubtitle">di 0 ore contrattuali</div>
            </div>

            <div class="card">
                <h3>Ore Mese Corrente</h3>
                <div class="value" id="monthHours">0</div>
                <div class="subtitle" id="monthName">Mese Corrente</div>
            </div>

            <div class="card">
                <h3>Guadagno Mese</h3>
                <div class="value" id="monthEarnings">€0</div>
                <div class="subtitle">Contratto + Extra</div>
            </div>

            <div class="card">
                <h3>Totale Guadagnato</h3>
                <div class="value" id="totalEarnings">€0</div>
                <div class="subtitle">Dall'inizio contratto</div>
            </div>

            <div class="card">
                <h3>Già pagato Extra</h3>
                <div class="value" id="extraPaid">€0</div>
                <div class="subtitle">
                    <input type="number" id="extraPaidInput" min="0" step="0.01" style="width:120px;display:none;"
                        placeholder="Inserisci € pagato">
                    <button id="saveExtraPaidBtn" style="display:none;" onclick="saveExtraPaid()">Salva</button>
                    <div id="extraPaidHelp" style="font-size:0.95em;color:#475569;margin-top:6px;display:none;">
                        Inserisci qui quanto ti è già stato pagato per gli extra. Il sistema calcolerà la differenza tra
                        extra maturati e già pagato.</div>
                </div>
            </div>

            <div class="card">
                <h3>Da dare/Da avere Extra</h3>
                <div class="value" id="extraToGive">€0</div>
                <div class="subtitle">Extra maturati - già pagato</div>
            </div>
        </div>

        <div class="detail-summary">
            <div class="detail-header">
                <h2 style="color: #667eea; margin: 0;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round"
                        class="lucide lucide-chart-no-axes-column-icon lucide-chart-no-axes-column">
                        <path d="M5 21v-6" />
                        <path d="M12 21V3" />
                        <path d="M19 21V9" />
                    </svg> Riepilogo Dettagliato</h2>
                <div class="detail-controls">
                    <select id="detailMonthFilter" onchange="setDetailView('custom')">
                        <option value="current">Mese Corrente</option>
                    </select>
                    <button onclick="setDetailView('total')" id="btnTotal" class="btn-secondary-style">Totale</button>
                </div>
            </div>

            <div class="dashboard detail-dashboard">
                <div class="card bg-blue-gradient">
                    <h3 class="text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-clock-icon lucide-clock">
                            <path d="M12 6v6l4 2" />
                            <circle cx="12" cy="12" r="10" />
                        </svg> Ore Totali</h3>
                    <div class="value text-white" id="totalHours">0h</div>
                    <div class="subtitle text-white">Contratto + Extra</div>
                </div>

                <div class="card bg-blue-gradient">
                    <h3 class="text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-scroll-text-icon lucide-scroll-text">
                            <path d="M15 12h-5" />
                            <path d="M15 8h-5" />
                            <path d="M19 17V5a2 2 0 0 0-2-2H4" />
                            <path
                                d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3" />
                        </svg> Ore Contratto</h3>
                    <div class="value text-white" id="contractHoursTotal">0h</div>
                    <div class="subtitle text-white" id="contractEarnings">€0</div>
                </div>

                <div class="card bg-green-gradient">
                    <h3 class="text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-clock-fading-icon lucide-clock-fading">
                            <path d="M12 2a10 10 0 0 1 7.38 16.75" />
                            <path d="M12 6v6l4 2" />
                            <path d="M2.5 8.875a10 10 0 0 0-.5 3" />
                            <path d="M2.83 16a10 10 0 0 0 2.43 3.4" />
                            <path d="M4.636 5.235a10 10 0 0 1 .891-.857" />
                            <path d="M8.644 21.42a10 10 0 0 0 7.631-.38" />
                        </svg> Ore Extra</h3>
                    <div class="value text-white" id="extraHoursTotal">0h</div>
                    <div class="subtitle text-white" id="extraEarnings">€0</div>
                </div>

                <div class="card bg-pink-gradient">
                    <h3 class="text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro-icon lucide-euro">
                            <path d="M4 10h12" />
                            <path d="M4 14h9" />
                            <path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2" />
                        </svg> Totale</h3>
                    <div class="value text-white" id="grandTotal">€0</div>
                    <div class="subtitle text-white" id="grandTotalHours">0h lavorate</div>
                </div>
            </div>
        </div>
        <div class="input-section">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-plus-icon lucide-plus">
                    <path d="M5 12h14" />
                    <path d="M12 5v14" />
                </svg> Aggiungi Nuovo Turno</h2>
            <div class="input-row">
                <div class="input-group">
                    <label for="newDate">Data</label>
                    <input type="date" id="newDate">
                </div>
                <div class="input-group">
                    <label for="newStart">Ora Entrata</label>
                    <input type="time" id="newStart">
                </div>
                <div class="input-group">
                    <label for="newEnd">Ora Uscita</label>
                    <input type="time" id="newEnd">
                </div>
                <div class="input-group">
                    <label for="newNotes">Note</label>
                    <input type="text" id="newNotes" placeholder="Note (Es. Feriale, Malattia, Extra)" maxlength="50">
                </div>
                <button onclick="addShift()">Aggiungi Turno</button>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h2 style="color: #667eea;display:flex;align-items:center;gap:4px;"><svg
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-calendar-days-icon lucide-calendar-days">
                        <path d="M8 2v4" />
                        <path d="M16 2v4" />
                        <rect width="18" height="18" x="3" y="4" rx="2" />
                        <path d="M3 10h18" />
                        <path d="M8 14h.01" />
                        <path d="M12 14h.01" />
                        <path d="M16 14h.01" />
                        <path d="M8 18h.01" />
                        <path d="M12 18h.01" />
                        <path d="M16 18h.01" />
                    </svg> Storico Turni</h2>
                    <button id="payslipBtn" style="margin-bottom:10px;display:none;" onclick="openPayslipModal()">Ho ricevuto la busta paga di <span id="payslipMonthName"></span></button>
                <div class="table-controls">
                    <span id="saveStatus" style="color: #667eea;">Attendere caricamento...</span>
                    <select id="monthFilter" onchange="filterData()">
                        <option value="all">Tutti i mesi</option>
                    </select>
                </div>
            </div>

            <table id="shiftsTable">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Giorno</th>
                        <th>Entrata</th>
                        <th>Uscita</th>
                        <th>Ore Totali</th>
                        <th>Ore Contratto</th>
                        <th>Ore Extra</th>
                        <th>Guadagno</th>
                        <th>Note</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody id="shiftsBody">
                </tbody>
            </table>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-lock-keyhole-open-icon lucide-lock-keyhole-open">
                    <circle cx="12" cy="16" r="1" />
                    <rect width="18" height="12" x="3" y="10" rx="2" />
                    <path d="M7 10V7a5 5 0 0 1 9.33-2.5" />
                </svg> Accesso Profilo</h2>
            <p id="loginMessage" class="modal-message"></p>
            <input type="hidden" id="tempProfileId">
            <div class="input-group">
                <label for="loginPIN">PIN (4-6 cifre)</label>
                <input type="password" id="loginPIN" inputmode="numeric" pattern="\d{4,6}" maxlength="6">
            </div>
            <div class="modal-buttons">
                <button onclick="changeProfile()" class="btn-secondary">Annulla e Cambia Profilo</button>
                <button onclick="attemptLogin()">Accedi</button>
            </div>
            <p class="warning-text">Attenzione: la sicurezza è client-side, usalo solo con persone di fiducia.</p>
        </div>
    </div>

    <div id="createProfileModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-user-round-plus-icon lucide-user-round-plus">
                    <path d="M2 21a8 8 0 0 1 13.292-6" />
                    <circle cx="10" cy="8" r="5" />
                    <path d="M19 16v6" />
                    <path d="M22 19h-6" />
                </svg> Crea Nuovo Profilo</h2>
            <p id="newProfileMessage" class="modal-message">Inserisci nome e PIN (numerico) per il nuovo profilo.</p>

            <div class="input-group" style="margin-bottom: 15px;">
                <label for="newProfileName">Nome/Soprannome (es. Matteo, Antonio_P)</label>
                <input type="text" id="newProfileName">
            </div>

            <div class="input-group">
                <label for="newProfilePin">PIN di Accesso (4-6 cifre)</label>
                <input type="password" id="newProfilePin" inputmode="numeric" pattern="\d{4,6}" maxlength="6">
            </div>

            <div class="modal-buttons">
                <button onclick="closeModal('createProfileModal')" class="btn-secondary">Annulla</button>
                <button onclick="createNewProfile()">Crea Profilo</button>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-pencil-icon lucide-pencil">
                    <path
                        d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                    <path d="m15 5 4 4" />
                </svg> Modifica Turno</h2>
            <input type="hidden" id="editIndex">
            <div class="input-group" style="margin-bottom: 15px;">
                <label for="editDate">Data</label>
                <input type="date" id="editDate">
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label for="editStart">Ora Entrata</label>
                <input type="time" id="editStart">
            </div>
            <div class="input-group">
                <label for="editEnd">Ora Uscita</label>
                <input type="time" id="editEnd">
            </div>
            <div class="input-group">
                <label for="editNotes">Ora Uscita</label>
                <input type="text" id="editNotes" placeholder="Note (Es. Feriale, Malattia, Extra)" maxlength="50">
            </div>
            <div class="modal-buttons">
                <button onclick="closeModal('editModal')" class="btn-secondary">Annulla</button>
                <button onclick="saveEdit()">Salva Modifiche</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-settings-icon lucide-settings">
                    <path
                        d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915" />
                    <circle cx="12" cy="12" r="3" />
                </svg> Impostazioni Calcoli</h2>
        <div id="payslipModal" class="modal">
            <div class="modal-content" style="max-width:400px;">
                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-check-icon lucide-file-check"><path d="M9 15l2 2 4-4"/><path d="M4 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l7 7v13a2 2 0 0 1-2 2H4z"/></svg> Conferma Busta Paga</h2>
                <p>Conferma di aver ricevuto la busta paga di <span id="modalPayslipMonth"></span>.<br>Puoi aggiornare i dati della busta paga qui sotto:</p>
                <div class="input-group">
                    <label for="modalPayHours">Ore lavorate (da busta paga)</label>
                    <input type="number" id="modalPayHours" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="modalPayNet">Netto busta paga (€)</label>
                    <input type="number" id="modalPayNet" step="1" min="0">
                </div>
                <div class="modal-buttons">
                    <button onclick="closeModal('payslipModal')" class="btn-secondary">Annulla</button>
                    <button onclick="confirmPayslip()">Conferma e aggiorna</button>
                </div>
            </div>
        </div>

            <h3>Contratto</h3>
            <div class="settings-input-grid">
                <div class="input-group">
                    <label for="contractStartDate">Data Inizio Contratto (AAAA-MM-GG)</label>
                    <input type="date" id="contractStartDate">
                </div>
                <div class="input-group">
                    <label for="weeklyHours">Ore Settimanali da Contratto (es. 18)</label>
                    <input type="number" id="weeklyHours" step="0.5" min="0">
                </div>
            </div>

            <h3>Ultima Busta Paga (Per Calcolo Costo Orario Contratto)</h3>
            <div class="settings-input-grid">
                <div class="input-group">
                    <label for="lastPayHours">Totale Ore Lavorate (da Busta Paga)</label>
                    <input type="number" id="lastPayHours" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="lastPayNet">Netto Busta Paga (€)</label>
                    <input type="number" id="lastPayNet" step="1" min="0">
                </div>

                <div class="rate-display">
                    Tasso Orario Contrattuale Calcolato: **€<span id="calculatedRate">---</span>/h**
                </div>
            </div>

            <h3>Extra</h3>
            <div class="settings-input-grid">
                <div class="input-group">
                    <label for="extraRateInput">Costo Orario Extra (€/h)</label>
                    <input type="number" id="extraRateInput" step="0.5" min="0">
                </div>
            </div>

            <div class="modal-buttons">
                <span id="settingsSaveStatus" class="modal-message" style="margin-right: auto;"></span>
                <button onclick="closeModal('settingsModal')" class="btn-secondary">Annulla</button>
                <button onclick="saveSettings()">Salva Impostazioni</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>